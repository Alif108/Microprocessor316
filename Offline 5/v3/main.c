#define F_CPU 1000000
#include <avr/io.h>
#include <util/delay.h>
#include <avr/interrupt.h>

int i=0, j=0, k=0;
int state = 0;

char column[] = {1, 2, 4, 8, 16, 32, 64, 128};
char row[][8] = {
	{0x00,0x2c,0x4a,0x89,0x81,0x42,0x3c,0x00},
	{0x00,0x00,0x2c,0x4a,0x89,0x81,0x42,0x3c},
	{0x3c,0x00,0x00,0x2c,0x4a,0x89,0x81,0x42},
	{0x42,0x3c,0x00,0x00,0x2c,0x4a,0x89,0x81},
	{0x81,0x42,0x3c,0x00,0x00,0x2c,0x4a,0x89},
	{0x89,0x81,0x42,0x3c,0x00,0x00,0x2c,0x4a},
	{0x4a,0x89,0x81,0x42,0x3c,0x00,0x00,0x2c},
	{0x2c,0x4a,0x89,0x81,0x42,0x3c,0x00,0x00}
};

ISR(INT0_vect)
{
	state = 1 - state;
}

int main(void)
{
	DDRB = 0xFF;
	DDRA = 0xFF;
	
	PORTD = (1<<2);				//	INT0
	GICR = (1<<6);
	MCUCR = 0x02;				//	Falling Edge
	
	sei();
	
	while(1)
	{
		while(state)
		{
			for(k=0; k<50; k++)					// how fast the shifting would be
			{
				PORTA = column[i];
				PORTB = ~row[j][i];
				_delay_ms(2);
				
				i++;
				
				if(i>7)
				i = 0;
			}
			
			j++;
			if(j>7)
			{
				j = 0;
			}
			
			_delay_ms(100);
		}
		
		PORTA = column[i];
		PORTB = ~row[j][i];
		_delay_ms(2);
		i++;
		if(i>7)
		i = 0;
	}
}