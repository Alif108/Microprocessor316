#define F_CPU 1000000
#include <avr/io.h>
#include <util/delay.h>
#include <avr/interrupt.h>

int i=0, j=0, k=0;
int state = 0;

char row[] = {1, 2, 4, 8, 16, 32, 64, 128};
char column[][8] = {
	{0x18,0x24,0x42,0x40,0x4e,0x42,0x24,0x18},
	{0x30,0x48,0x84,0x80,0x9c,0x84,0x48,0x30},
	{0x60,0x90,0x09,0x01,0x39,0x09,0x90,0x60},
	{0xc0,0x21,0x12,0x02,0x72,0x12,0x21,0xc0},
	{0x81,0x42,0x24,0x04,0xe4,0x24,0x42,0x81},
	{0x03,0x84,0x48,0x08,0xc9,0x48,0x84,0x03},
	{0x06,0x09,0x90,0x10,0x93,0x90,0x09,0x06},
	{0x0c,0x12,0x21,0x20,0x27,0x21,0x12,0x0c}
	};
	
ISR(INT0_vect)
{
	state = 1 - state;
}

int main(void)
{
	DDRB = 0xFF;
	DDRA = 0xFF;
	
	PORTD = (1<<2);				//	INT0
	GICR = (1<<6);
	MCUCR = 0x02;				//	Falling Edge
	
	sei();
	
   	while(1)
   	{
	   	while(state)
	   	{	
		   	for(k=0; k<50; k++)					// how fast the shifting would be
		   	{
			   	PORTA = row[i];
			   	PORTB = ~column[j][i];
			   	_delay_ms(2);
				   	
			   	i++;
				   	
			   	if(i>7)
			   	i = 0;
		   	}
			   
		   	j++;
			if(j>7)
			{
			   	j = 0;
		   	}
			   
		   	_delay_ms(100);
		}
		
		PORTA = row[i];
		PORTB = ~column[j][i];
		_delay_ms(2);
		i++;
		if(i>7)
			i = 0;
   	}
}